# 🚀 Быстрый запуск HNS Studio на Ubuntu сервере

## Способ 1: Автоматический запуск (рекомендуется)

### Одна команда для полного развертывания:

```bash
# Скачайте и запустите автоматический installer
curl -o deploy.sh https://raw.githubusercontent.com/your-repo/hns-studio/main/deploy.sh
chmod +x deploy.sh

# Запустите развертывание (замените на ваши данные)
sudo ./deploy.sh hns.dev MySecurePass123 your_telegram_bot_token your_telegram_chat_id
```

**Что произойдет автоматически:**
- ✅ Установка Node.js 20, PostgreSQL, Nginx
- ✅ Настройка базы данных и пользователей
- ✅ Получение SSL сертификата (Let's Encrypt)
- ✅ Настройка файрвола и безопасности
- ✅ Конфигурация PM2 для управления процессами

### Загрузка и запуск проекта:

```bash
# Перейдите в созданную директорию
cd /var/www/hns-studio

# Скопируйте файлы проекта сюда (любым способом)
# Например, через git:
# git clone https://github.com/your-repo/hns-studio.git .

# Запустите сборку и деплой
sudo -u hns ./update.sh
```

### Готово! 
Откройте в браузере: `https://hns.dev`

---

## Способ 2: Docker развертывание

```bash
# Скачайте Docker installer
curl -o docker-deploy.sh https://raw.githubusercontent.com/your-repo/hns-studio/main/docker-deploy.sh
chmod +x docker-deploy.sh

# Запустите Docker развертывание
sudo ./docker-deploy.sh hns.dev MySecurePass123 your_telegram_bot_token your_telegram_chat_id
```

---

## Способ 3: Ручная установка (если нужен полный контроль)

### 1. Подготовка сервера
```bash
# Обновление системы
sudo apt update && sudo apt upgrade -y

# Установка Node.js 20
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
sudo apt install -y nodejs

# Установка PostgreSQL
sudo apt install -y postgresql postgresql-contrib

# Установка Nginx
sudo apt install -y nginx

# Установка PM2
sudo npm install -g pm2

# Установка Certbot для SSL
sudo apt install -y certbot python3-certbot-nginx
```

### 2. Настройка базы данных
```bash
sudo -u postgres psql
```

В PostgreSQL консоли:
```sql
CREATE DATABASE hns_studio;
CREATE USER hns_user WITH PASSWORD 'ваш_пароль';
GRANT ALL PRIVILEGES ON DATABASE hns_studio TO hns_user;
\q
```

### 3. Развертывание проекта
```bash
# Создание директории
sudo mkdir -p /var/www/hns-studio
sudo chown $USER:$USER /var/www/hns-studio
cd /var/www/hns-studio

# Скопируйте файлы проекта сюда

# Установка зависимостей
npm install

# Создание .env файла
cat > .env <<EOF
NODE_ENV=production
PORT=3000
DATABASE_URL=postgresql://hns_user:ваш_пароль@localhost:5432/hns_studio
TELEGRAM_BOT_TOKEN=ваш_telegram_bot_token
TELEGRAM_CHAT_ID=ваш_telegram_chat_id
EOF

# Сборка проекта
npm run build

# Запуск через PM2
pm2 start ecosystem.config.js
pm2 save
pm2 startup
```

### 4. Настройка Nginx
```bash
sudo nano /etc/nginx/sites-available/hns.dev
```

Конфигурация Nginx:
```nginx
server {
    listen 80;
    server_name hns.dev www.hns.dev;

    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }
}
```

```bash
# Активация сайта
sudo ln -s /etc/nginx/sites-available/hns.dev /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
```

### 5. SSL сертификат
```bash
sudo certbot --nginx -d hns.dev -d www.hns.dev
```

---

## Управление проектом

### PM2 команды:
```bash
pm2 status                  # Статус приложения
pm2 logs hns-studio        # Просмотр логов
pm2 restart hns-studio     # Перезапуск
pm2 stop hns-studio        # Остановка
```

### Обновление проекта:
```bash
cd /var/www/hns-studio
git pull                    # Получение обновлений
npm install                 # Обновление зависимостей
npm run build              # Пересборка
pm2 restart hns-studio    # Перезапуск
```

### Мониторинг:
```bash
# Логи приложения
pm2 logs hns-studio

# Логи Nginx
sudo tail -f /var/log/nginx/error.log

# Статус сервисов
sudo systemctl status nginx postgresql
```

---

## Требования к серверу

- **OS**: Ubuntu 20.04 LTS или новее
- **RAM**: Минимум 2GB (рекомендуется 4GB)
- **Диск**: Минимум 20GB свободного места
- **Сеть**: Публичный IP адрес
- **Домен**: Настроенный домен, указывающий на IP сервера

---

## Решение проблем

### Приложение не запускается:
```bash
pm2 logs hns-studio        # Проверить логи
npm run build              # Пересобрать проект
pm2 restart hns-studio    # Перезапустить
```

### Ошибка 502 Bad Gateway:
```bash
sudo systemctl status nginx    # Статус Nginx
pm2 status                     # Статус PM2
sudo netstat -tlnp | grep :3000  # Проверить порт
```

### Проблемы с SSL:
```bash
sudo certbot renew            # Обновить сертификат
sudo systemctl reload nginx   # Перезагрузить Nginx
```

### База данных недоступна:
```bash
sudo systemctl status postgresql  # Статус PostgreSQL
sudo -u postgres psql -l          # Список баз данных
```

---

## Поддержка

📧 **Email**: info@hns.dev  
🌐 **Сайт**: https://hns.dev  
📚 **Документация**: `DEPLOYMENT.md` и `quick-deploy.md`