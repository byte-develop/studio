# Простая инструкция для пустого Ubuntu сервера

## Шаг 1: Скопируй и выполни эту команду

```bash
curl -s https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.7/install.sh | bash && \
source ~/.bashrc && \
nvm install 20 && \
nvm use 20 && \
sudo apt update && \
sudo apt install -y git nginx postgresql postgresql-contrib && \
sudo npm install -g pm2
```

## Шаг 2: Настрой базу данных

```bash
sudo -u postgres createuser --interactive --pwprompt hns_user
# Введи пароль: MySecurePass123
# На вопросы отвечай: n, n, n

sudo -u postgres createdb -O hns_user hns_studio
```

## Шаг 3: Создай директорию проекта

```bash
sudo mkdir -p /var/www/hns-studio
sudo chown $USER:$USER /var/www/hns-studio
cd /var/www/hns-studio
```

## Шаг 4: Загрузи файлы проекта

Вариант А - если есть git репозиторий:
```bash
git clone https://your-repo-url.git .
```

Вариант Б - загрузи файлы вручную через SCP/SFTP

## Шаг 5: Настрой проект

```bash
# Установи зависимости
npm install

# Собери проект  
npm run build

# Создай .env файл с правильным портом
cat > .env << EOF
NODE_ENV=production
PORT=5000
DATABASE_URL=postgresql://hns_user:MySecurePass123@localhost:5432/hns_studio
EOF

# Создай папку для статических файлов
mkdir -p server/public
cp -r dist/public/* server/public/ 2>/dev/null || echo "Статика скопирована"
```

## Шаг 6: Настрой Nginx

```bash
# Создай конфиг (замени your-domain.com на свой домен)
sudo tee /etc/nginx/sites-available/your-domain.com << EOF
server {
    listen 80;
    server_name your-domain.com www.your-domain.com;

    location / {
        proxy_pass http://localhost:5000;
        proxy_set_header Host \$host;
        proxy_set_header X-Real-IP \$remote_addr;
        proxy_set_header X-Forwarded-For \$proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto \$scheme;
    }

    location /assets/ {
        alias /var/www/hns-studio/dist/public/assets/;
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}
EOF

# Активируй сайт
sudo ln -s /etc/nginx/sites-available/your-domain.com /etc/nginx/sites-enabled/
sudo rm -f /etc/nginx/sites-enabled/default
sudo nginx -t
sudo systemctl restart nginx
```

## Шаг 7: Запусти приложение

```bash
# Создай PM2 конфиг для скомпилированного файла
cat > ecosystem.config.cjs << EOF
module.exports = {
  apps: [{
    name: 'hns-studio',
    script: 'dist/index.js',
    env: {
      NODE_ENV: 'production',
      PORT: 5000
    },
    error_file: './logs/err.log',
    out_file: './logs/out.log'
  }]
};
EOF

# Создай папку для логов
mkdir -p logs

# Запусти скомпилированную версию (избегает проблем с tsx)
pm2 start ecosystem.config.cjs
pm2 save
pm2 startup
```

## Шаг 8: Получи SSL (опционально)

```bash
sudo apt install certbot python3-certbot-nginx
sudo certbot --nginx -d your-domain.com
```

## Готово!

Твой сайт должен работать на http://your-domain.com

### Если что-то не работает:

```bash
# Проверь статус
pm2 status
pm2 logs hns-studio

# Проверь Nginx
sudo systemctl status nginx
sudo nginx -t

# Проверь базу данных
sudo systemctl status postgresql
```